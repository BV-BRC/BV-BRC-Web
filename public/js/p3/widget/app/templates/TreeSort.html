<form dojoAttachPoint="containerNode" class="PanelForm"
   dojoAttachEvent="onreset:_onReset,onsubmit:_onSubmit,onchange:validate">

   <!-- DMD TEST-->
   <br />

   <div class="appTemplate">
      <div class="appTitle">
         <span class="breadcrumb">Services</span>
         <h1 class="appHeader">TreeSort
            <div name="overview" class="infobox iconbox infobutton dialoginfo">
               <i class="fa icon-info-circle fa" title="click to open info dialog"></i>
            </div>
            <div class="infobox iconbox tutorialButton tutorialInfo">
               <a href="${docsServiceURL}${tutorialLink}" target="_blank">
                  <i class="fa icon-books fa-1x" title="click to open tutorial"></i>
               </a>
            </div>
         </h1>
         <p>${applicationDescription} Link to <a href="https://github.com/flu-crew/TreeSort" target="_blank">TreeSort</a>.</p>
         <br/>
         <p>For further explanation, please see the ${applicationLabel} Service
            <a href="${docsServiceURL}${applicationHelp}" target="_blank">Quick Reference Guide</a> and
            <a href="${docsServiceURL}${tutorialLink}" target="_blank">Tutorial</a>.
         </p>
      </div>


      <div class="appBox appShadow" style="margin-top:10px">

         <div class="headerrow">
            <div style="width:85%;display:inline-block;">
               <label class="appBoxLabel">Input data</label>
               <div name="query-source" class="infobox iconbox infobutton dialoginfo">
                  <i class="fa icon-info-circle fa" title="click to open info dialog"></i>
               </div>
            </div>
            <br/>

            <!-- Radio buttons to determine the input source -->
            <div class="appRow">
               <input name="input_source"
                  data-dojo-attach-event="onChange:onInputSourceChange"
                  data-dojo-attach-point="inputSourceFastaDataEl"
                  data-dojo-type="dijit/form/RadioButton"
                  id="${id}_inputSourceFastaData"
                  type="radio"
                  value="fasta_data"
                  checked
               />
               <label for="${id}_inputSourceFastaData">Enter sequence</label>&nbsp;&nbsp;

               <input name="input_source"
                  data-dojo-attach-event="onChange:onInputSourceChange"
                  data-dojo-attach-point="inputSourceFastaFileIdEl"
                  data-dojo-type="dijit/form/RadioButton"
                  id="${id}_inputSourceFastaFileId"
                  type="radio"
                  value="fasta_file_id"
               />
               <label for="${id}_inputSourceFastaFileId">Select FASTA file</label>&nbsp;&nbsp;

               <input name="input_source"
                  data-dojo-attach-event="onChange:onInputSourceChange"
                  data-dojo-attach-point="inputSourceFastaGroupIdEl"
                  data-dojo-type="dijit/form/RadioButton"
                  id="${id}_inputSourceFastaGroupId"
                  type="radio"
                  value="fasta_group_id"
               />
               <label for="${id}_inputSourceFastaGroupId">Select genome group</label>&nbsp;&nbsp;

               <input name="input_source"
                  data-dojo-attach-event="onChange:onInputSourceChange"
                  data-dojo-attach-point="inputSourceFastaExistingDatasetEl"
                  data-dojo-type="dijit/form/RadioButton"
                  id="${id}_inputSourceFastaExistingDataset"
                  type="radio"
                  value="existing_dataset"
               />
               <label for="${id}_inputSourceFastaExistingDataset">Use existing data</label>
            </div>

            <!-- FASTA data -->
            <table data-dojo-attach-point="fastaDataPanelEl" style="width:100%; display:none">
               <tr>
                  <td>
                     <textarea name="fasta_data"
                        data-dojo-attach-event="onBlur:validateFastaData"
                        data-dojo-attach-point="fastaDataEl"
                        data-dojo-props="rows:13, placeholder:'Enter one or more nucleotide sequences in FASTA format.', intermediateChanges:true"
                        data-dojo-type="dijit/form/Textarea"
                        required="false"
                        style="width:96%; height:175px; margin-left:10px; font-family: monospace; font-size:12px"
                     ></textarea>
                     <div class="warning" data-dojo-attach-point="fastaDataMessageEl"></div>
                  </td>
               </tr>
            </table>

            <!-- FASTA file ID -->
            <table data-dojo-attach-point="fastaFileIdPanelEl" style="width:100%; display:none">
               <tr>
                  <td>
                     <div name="fasta_file_id"
                        data-dojo-attach-event="onChange:validateFastaFileID"
                        data-dojo-attach-point="fastaFileIdEl"
                        data-dojo-type="p3/widget/WorkspaceObjectSelector"
                        data-dojo-props="type:['feature_protein_fasta', 'feature_dna_fasta', 'genome_protein_fasta', 'genome_dna_fasta', 'contigs'],multi:false,promptMessage:'Select or upload a FASTA file from your workspace.',missingMessage:'FASTA file is required.',placeHolder:'FASTA file'"
                        required="false"
                        style="width:85%;display:inline-block;"
                     ></div>
                  </td>
               </tr>
            </table>

            <!-- FASTA group ID -->
            <table data-dojo-attach-point="fastaGroupIdPanelEl" style="width:100%; display:none">
               <tr>
                  <td>
                     <div name="fasta_group_id"
                        data-dojo-attach-event="onChange:validateFastaGroupID"
                        data-dojo-attach-point="fastaGroupIdEl"
                        data-dojo-props="type:['genome_group'],multi:false,promptMessage:'Select a genome group from your workspace.',missingMessage:'Genome group is required.',placeHolder:'Genome group'"
                        data-dojo-type="p3/widget/WorkspaceObjectSelector"
                        required="false"
                        style="width:85%;display:inline-block;"
                     ></div>
                  </td>
               </tr>
            </table>

            <!-- Existing dataset -->
            <table data-dojo-attach-point="fastaExistingDatasetPanelEl" style="width:100%; display:none">
               <tr>
                  <td>
                     <div name="fasta_existing_dataset"
                        data-dojo-attach-event="onChange:validateFastaExistingDataset"
                        data-dojo-attach-point="fastaExistingDatasetEl"
                        data-dojo-props="type:['folder'],multi:false,promptMessage:'Select a folder containing an existing dataset.',missingMessage:'An existing dataset folder is required.',placeHolder:'Existing dataset directory'"
                        data-dojo-type="p3/widget/WorkspaceObjectSelector"
                        required="false"
                        style="width:85%;display:inline-block;"
                     ></div>
                  </td>
               </tr>
            </table>
         </div>
      </div>

      <div class="appBox appShadow">

         <!-- Output path -->
         <div class="appRow" style="margin-bottom: 1.0rem">
            <div style="text-align:left;">
               <div class="headerrow" style="margin-bottom: 7px">
                  <label class="appBoxLabel">Output path</label>
                  <div name="output_path" class="infobox iconbox infobutton dialoginfo">
                     <i class="fa icon-info-circle fa" title="click to open info dialog"></i>
                  </div>
               </div>
               <div name="output_path"
                  data-dojo-attach-event="onChange:onOutputPathChange"
                  data-dojo-attach-point="outputPathEl"
                  data-dojo-props="title:'Select an Output Folder',autoSelectCurrent:true,selectionText:'Destination',title:'Select an Output Folder',type:['folder'],multi:false,placeHolder:'Output Folder'"
                  data-dojo-type="p3/widget/WorkspaceObjectSelector"
                  required="true"
                  style="width: 32rem"></div>
               <div class="warning" data-dojo-attach-point="outputPathMessageEl"></div>
            </div>
         </div>
      </div>

      <div class="appBox appShadow">

         <div class="headerrow" style="margin-bottom: 7px">
            <label class="appBoxLabel">TreeSort parameters</label>
            <div name="treesort_parameters" class="infobox iconbox infobutton dialoginfo">
               <i class="fa icon-info-circle fa" title="click to open info dialog"></i>
            </div>
         </div>

         <!--<div class="appRow" style="margin-bottom: 1.0rem">
            <div style="align-items: flex-start; display: flex; flex-flow: row nowrap; justify-content: flex-start;">-->
         <table>
            <tr>
               <td>
                  <!-- Match type
                  <div style="margin-right: 2.0rem; text-align: left;">-->
                     <div class="paramlabel">Match type</div>
                     <div name="match_type"
                        data-dojo-attach-event="onChange:onMatchTypeChange"
                        data-dojo-attach-point="matchTypeEl"
                        data-dojo-props="disabled:false"
                        data-dojo-type="dijit/form/Select"
                        maxHeight="200"
                        required="true"
                     ></div>
                     <div class="warning" data-dojo-attach-point="matchTypeMessageEl"></div>
                  <!--</div>-->
               </td>
               <td>
                  <!-- Match regex -->
                  <div data-dojo-attach-point="matchRegexContainerEl" style="text-align: left; display: none">
                     <div class="paramlabel">Regular expression</div>
                     <input name="match_regex"
                        data-dojo-attach-event="onChange:validateMatchRegex"
                        data-dojo-attach-point="matchRegexEl"
                        data-dojo-props="trim:true, placeholder:'A regular expression', intermediateChanges:true"
                        data-dojo-type="dijit/form/ValidationTextBox"
                        required="false"
                        style="text-align: right; height:20px; font-family: monospace; font-size:12px" />
                     <div class="warning" data-dojo-attach-point="matchRegexMessageEl"></div>
                  </div>
               </td>
            </tr>
            <tr>
               <td>
               <!-- Reference segment -->
               <div style="margin-right: 2.0rem; text-align: left;">
                  <div class="paramlabel">Reference segment</div>
                  <div name="ref_segment"
                     data-dojo-attach-point="refSegmentEl"
                     data-dojo-props="disabled:false"
                     data-dojo-type="dijit/form/Select"
                     maxHeight="200"
                     required="true"
                     style="width:12rem">
                  </div>
                  <div class="warning" data-dojo-attach-point="refSegmentMessageEl"></div>
               </div>
               </td>
               <td>
               <!-- Segments -->
               <div style="text-align:left;">
                  <div class="paramlabel">Segments</div>
                  <div name="segments" data-dojo-attach-point="segmentsContainerEl"></div>
               </div>
               </td>
            </tr>
            <tr>
               <td>
               <!-- Inference method -->
               <div style="margin-right: 2.0rem; text-align: left;">
                  <div class="paramlabel">Inference method</div>
                  <div name="inference_method"
                     data-dojo-attach-point="inferenceMethodEl"
                     data-dojo-props="disabled:false"
                     data-dojo-type="dijit/form/Select"
                     maxHeight="200"
                     required="false"
                     style="width:12rem">
                  </div>
                  <div class="warning" data-dojo-attach-point="inferenceMethodMessageEl"></div>
               </div>
               </td>
               <td>
               <!-- Reference tree inference method -->
               <div style="text-align:left;">
                  <div class="paramlabel">Reference tree inference method</div>
                  <div name="ref_tree_inference"
                     data-dojo-attach-point="refTreeInferenceEl"
                     data-dojo-props="disabled:false"
                     data-dojo-type="dijit/form/Select"
                     maxHeight="200"
                     required="true"
                     style="width:12rem">
                  </div>
                  <div class="warning" data-dojo-attach-point="refTreeInferenceMessageEl"></div>
               </div>
               </td>
            </tr>
            <tr>
               <td>
                  <!-- Deviation -->
                  <div style="margin-right: 1.7rem; text-align: left;">
                     <div class="paramlabel">Deviation</div>
                     <input name="deviation"
                        data-dojo-attach-point="deviationEl"
                        data-dojo-props="trim:true,regExp:'(([0-9])+)', placeholder:'', intermediateChanges:true"
                        data-dojo-type="dijit/form/ValidationTextBox"
                        required="false"
                        style="text-align: right; height:20px; font-family: monospace; font-size:12px;"
                        value="2"/>
                     <div class="warning" data-dojo-attach-point="deviationMessageEl"></div>
                  </div>
               </td>
               <td>
                  <!-- P-value -->
                  <div style="text-align:left;">
                     <div class="paramlabel">P-value cutoff for reassortment tests</div>
                     <input name="p_value"
                        data-dojo-attach-point="pValueEl"
                        data-dojo-props="trim:true,regExp:'/^\d*(\.\d*)?$/', placeholder:'', intermediateChanges:true"
                        data-dojo-type="dijit/form/ValidationTextBox"
                        required="false"
                        style="text-align: right; height:20px; font-family: monospace; font-size:12px"
                        value="0.001"/>
                     <div class="warning" data-dojo-attach-point="pValueMessageEl"></div>
                  </div>
               </td>
            </tr>


         <!-- Equal rates
         <div class="appRow" style="margin-top: 1.0rem">
            <div id="${id}_equal_rates"
               data-dojo-attach-point="equalRatesEl"
               data-dojo-type="dijit/form/CheckBox"
               checked></div>
            <label for="${id}_equal_rates">Don’t estimate molecular clock rates for different segments</label>
         </div>-->

         <!-- Is time scaled
         <div class="appRow" style="margin-top: 1.0rem">
            <div id="${id}_is_time_scaled"
               data-dojo-attach-point="isTimeScaledEl"
               data-dojo-type="dijit/form/CheckBox"
               checked></div>
            <label for="${id}_equal_rates">Time-scale the reference tree</label>
         </div>-->

         <!-- No collapse
         <div class="appRow" style="margin-top: 1.0rem">
            <div id="${id}_no_collapse"
               data-dojo-attach-point="noCollapseEl"
               data-dojo-type="dijit/form/CheckBox"
               checked></div>
            <label for="${id}_no_collapse">Collapse near-zero length branches into multifurcations</label>
         </div>-->

         </table>

         <!--
         <table>
            <tr>
               <td>
                  <div class="headerrow" style="margin: 16px 0 7px 0">
                     <label class="appBoxLabel">Output Folder</label>
                     <div name="output-folder" class="infobox iconbox infobutton dialoginfo">
                        <i class="fa icon-info-circle fa" title="click to open info dialog"></i>
                     </div>
                  </div>
                  <div data-dojo-type="p3/widget/WorkspaceObjectSelector" name="output_path"
                     data-dojo-attach-point="output_path" style="width:300px" required="true"
                     data-dojo-props="title:'Select an Output Folder',autoSelectCurrent:true,selectionText:'Destination',title:'Select an Output Folder',type:['folder'],multi:false,placeHolder:'Output Folder'"
                     data-dojo-attach-event="onChange:onOutputPathChange"></div>
               </td>
               <td>
                  <div class="headerrow" style="margin: 16px 0 7px 0">
                     <label class="appBoxLabel">Output Name</label>
                     <div name="output-name" class="infobox iconbox infobutton dialoginfo">
                        <i class="fa icon-info-circle fa" title="click to open info dialog"></i>
                     </div>
                     <span class="charError"
                        style="color:red; font-size:8pt; padding-left:10px; font-weight:bold">&nbsp;</span><br/>
                  </div>
                  <div data-dojo-type="p3/widget/WorkspaceFilenameValidationTextBox" name="output_file"
                     data-dojo-attach-event="onChange:checkOutputName" data-dojo-attach-point="output_file"
                     style="width:300px" required="true"
                     data-dojo-props="intermediateChanges:true,missingMessage:'Name must be provided for the job result',trim:true,placeHolder:'Output Name'">
                  </div>
               </td>
            </tr>
         </table> -->

         <div class="warning" data-dojo-attach-point="database_message"></div>
      </div>
   </div>
   <div class="appSubmissionArea">
      <div data-dojo-attach-point="workingMessage" class="messageContainer workingMessage"
         style="margin-top:10px; text-align:center;">
         Submitting ${applicationLabel} job
      </div>
      <div data-dojo-attach-point="errorMessage" class="messageContainer errorMessage"
         style="margin-top:10px; text-align:center;">
         Error submitting job
      </div>
      <div data-dojo-attach-point="submittedMessage" class="messageContainer submittedMessage"
         style="margin-top:10px; text-align:center;">
         Your job has been submitted successfully. Please visit your <a
            data-dojo-attach-event="onclick:openJobsList"><u>Jobs List</u> </a>to check the status of your job and
         access the results.
      </div>
      <div style="margin-top: 10px; text-align:center;">
         <div data-dojo-attach-point="cancelButton" data-dojo-attach-event="onClick:onCancel"
            data-dojo-type="dijit/form/Button">Cancel
         </div>
         <div data-dojo-attach-point="resetButton" type="reset" data-dojo-type="dijit/form/Button">Reset
         </div>
         <div data-dojo-attach-point="submitButton" type="submit" data-dojo-type="dijit/form/Button">Submit
         </div>
      </div>
   </div>
</form>